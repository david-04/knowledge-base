
<div id='nodeSection1'>Creating and maintaining indices</div>
<p><span class=rvts12><br></span></p>
<p><span class=rvts64>CREATE</span><span class=rvts61> </span><span class=rvts64>UNIQUE</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>CLUSTERED</span><span class=rvts63>|</span><span class=rvts64>NONCLUSTERED</span><span class=rvts63>}</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- clustered: table is sorted physically, non-clustered (=default): additional add-on index</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>INDEX</span><span class=rvts61> my_index</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ON</span><span class=rvts61> my_table</span><span class=rvts64> </span><span class=rvts63>(</span><span class=rvts61>col1 </span><span class=rvts64>ASC</span><span class=rvts63>,</span><span class=rvts61> col2 </span><span class=rvts64>DESC</span><span class=rvts63>)</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>WHERE</span><span class=rvts61> col1 </span><span class=rvts63>&lt;</span><span class=rvts61> 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- optional: create the index only for certain rows (save space and maintenance costs)</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>INCLUDE </span><span class=rvts63>(</span><span class=rvts61>col3</span><span class=rvts63>,</span><span class=rvts61> col4</span><span class=rvts63>)</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- add these columns as additional data to the index (so queries don't have to access the source data)</span></p>
<p><span class=rvts61>&nbsp; </span><span class=rvts64>WITH</span><span class=rvts61> </span><span class=rvts64>FILLFACTOR</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> 0.</span><span class=rvts63>.</span><span class=rvts61>.100</span><span class=rvts63>,</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- set for example to 50 to only fill 50% of the index pages with actual data</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>PAD_INDEX</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- apply the FILLFACTOR to leafs as well</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>DROP_EXISTING</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- increase performance when rebuilding a clustered index on tables that have non-clustered indices as well</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>SORT_IN_TEMPDB</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- increases performance if TEMPDB is stored on another disk drive</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>IGNORE_DUP_KEY</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- if set to ON: inserting duplicate keys does not cause an error, only a warning is issued</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ALLOW_ROW_LOCKS</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- enable page and row locks</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ALLOW_PAGE_LOCKS</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>STATISTICS_NORECOMPUTE</span><span class=rvts61> </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- set to OFF to prevent the automatic recomputation of statistics</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ONLINE</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>}</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- set to ON to allow concurrent table access while the index is being (re-) built</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ON</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts61>file_group_name</span><span class=rvts63>|</span><span class=rvts61>"default"</span><span class=rvts63>}</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- store the index in the given file group or in the default file group</span></p>
<p><span class=rvts62><br></span></p>
<p><span class=rvts64>ALTER</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> idx_customer_name </span><span class=rvts64>on</span><span class=rvts61> customer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- modify an index's settings</span></p>
<p><span class=rvts64>SET</span><span class=rvts61> </span><span class=rvts64>FILLFACTOR</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> 0.</span><span class=rvts63>.</span><span class=rvts61>.100</span><span class=rvts63>,</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts64>PAD_INDEX</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts64>ON</span><span class=rvts63>|</span><span class=rvts64>OFF</span><span class=rvts63>},</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts63>...;</span></p>
<p><span class=rvts63><br></span></p>
<p><span class=rvts64>ALTER</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts61>my_index</span><span class=rvts63>|ALL}</span><span class=rvts61> </span><span class=rvts64>on</span><span class=rvts61> my_table </span><span class=rvts64>DISABLE</span><span class=rvts63>;</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- disable one or all indices (re-activate via REBUILD)</span></p>
<p><span class=rvts61><br></span></p>
<p><span class=rvts64>ALTER</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts61>my_index</span><span class=rvts63>|ALL}</span><span class=rvts61> </span><span class=rvts64>on</span><span class=rvts61> my_table </span><span class=rvts64>REORGANIZE</span><span class=rvts63>;</span><span class=rvts61>&nbsp; </span><span class=rvts62>-- reorganise one or all indices</span></p>
<p><span class=rvts61><br></span></p>
<p><span class=rvts64>ALTER</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> </span><span class=rvts63>{</span><span class=rvts61>my_index</span><span class=rvts63>|ALL}</span><span class=rvts61> </span><span class=rvts64>on</span><span class=rvts61> my_table&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- rebuild one or all indices</span></p>
<p><span class=rvts64>REBUILD</span><span class=rvts61> </span><span class=rvts64>PARTITION</span><span class=rvts63>=ALL;</span></p>
<p><span class=rvts12><br></span></p>
<p><span class=rvts64>EXEC</span><span class=rvts61> </span><span class=rvts65>sp_rename</span><span class=rvts64> </span><span class=rvts61>@objname</span><span class=rvts63>=</span><span class=rvts66>'my_table.my_index'</span><span class=rvts63>,</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- rename a stored procedure</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @newname</span><span class=rvts63>=</span><span class=rvts66>'my_table.my_index_2'</span><span class=rvts63>;</span><span class=rvts61> </span></p>
<p><span class=rvts61><br></span></p>
<p><span class=rvts64>DROP</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> my_index </span><span class=rvts64>ON</span><span class=rvts61> my_table</span><span class=rvts63>;</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- remove an index</span></p>
<p><span class=rvts61><br></span></p>
<p><span class=rvts9><br></span></p>
<div id='nodeSection2'>Retrieving index information</div>
<p><span class=rvts12><br></span></p>
<p><span class=rvts64>SELECT</span><span class=rvts61> </span><span class=rvts63>*</span><span class=rvts61> </span><span class=rvts64>FROM</span><span class=rvts61> sys.dm_db_index_physical_stats&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- retrieve index statistics</span></p>
<p><span class=rvts63>(</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts67>DB_ID</span><span class=rvts63>(</span><span class=rvts66>'my_database'</span><span class=rvts63>),</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- limit results to the given database and table</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts67>OBJECT_ID</span><span class=rvts63>(</span><span class=rvts66>'my_table'</span><span class=rvts63>),</span><span class=rvts61> </span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts63>NULL,</span><span class=rvts61> </span><span class=rvts63>NULL,</span><span class=rvts61> </span><span class=rvts63>NULL</span></p>
<p><span class=rvts63>);</span></p>
<p><span class=rvts63><br></span></p>
<p><span class=rvts64>EXECUTE</span><span class=rvts61> </span><span class=rvts65>sp_helpindex</span><span class=rvts64> </span><span class=rvts66>'my_table'</span><span class=rvts63>;</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- retrieve all indices of the given table</span></p>
<p><span class=rvts62><br></span></p>
<p><span class=rvts64>EXECUTE</span><span class=rvts61> </span><span class=rvts65>sp_helptext</span><span class=rvts64> </span><span class=rvts66>'my_view'</span><span class=rvts63>;</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- show information about a view</span></p>
<p><span class=rvts62><br></span></p>
<p><span class=rvts9><br></span></p>
<div id='nodeSection3'>Columnstore indices</div>
<p><span class=rvts12><br></span></p>
<p><span class=rvts64>CREATE</span><span class=rvts61> </span><span class=rvts64>CLUSTERED</span><span class=rvts61> </span><span class=rvts64>COLUMNSTORE</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> my_index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- create a columnstore (compressed versions of all columns ... full table copy!)</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ON</span><span class=rvts61> my_table</span><span class=rvts63>;</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- reduces I/O when only a few columns are requested (but modifications are expensive)</span></p>
<p><span class=rvts61><br></span></p>
<p><span class=rvts64>CREATE</span><span class=rvts61> </span><span class=rvts64>NONCLUSTERED</span><span class=rvts61> </span><span class=rvts64>COLUMNSTORE</span><span class=rvts61> </span><span class=rvts64>INDEX</span><span class=rvts61> my_index&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- create a a seconday columnstore (not compatible with a CLUSTERED COLUMNSTORE)</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts64>ON</span><span class=rvts61> my_table</span><span class=rvts63>(</span><span class=rvts61>col1</span><span class=rvts63>,</span><span class=rvts61> col2</span><span class=rvts63>,</span><span class=rvts61> </span><span class=rvts63>...);</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- only the selected columns are added to the columnstore</span></p>
<p><span class=rvts61>&nbsp;&nbsp;&nbsp; </span><span class=rvts64>WHERE</span><span class=rvts61> col3 </span><span class=rvts63>=</span><span class=rvts61> </span><span class=rvts63>...</span><span class=rvts61>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class=rvts62>-- nonclustered indices can have filter criteria</span></p>
<p><span class=rvts61><br></span></p>
<p><br></p>
<p><br></p>

